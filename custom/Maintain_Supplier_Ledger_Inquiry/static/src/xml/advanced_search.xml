<?xml version="1.0" encoding="utf-8"?>
<!-- webpage record -->
<template>
    <t t-name="supplier_ledger_inquiry.advanced_search">
        <table>
            <tr>
                <th>対象日付</th>
                <td>
                    <input class="filter-item" data-operator="gte" data-name="date" type="date"/>
                </td>
                <td><span>～</span></td>
                <td>
                    <input class="filter-item" data-operator="lte" data-name="date" type="date"/>
                </td>
            </tr>
            <tr>
                <th>請求先（得意先）コード</th>
                <td>
                    <input
                        class="filter-item"
                        id="billing_code_ledger_advanced_search"
                        data-operator="="
                        data-name="customer_code_bill"
                        onblur="onBlurBillingCode()"
                        type="search"
                    />
                    <span
                        class="o_apply_filter_customer_code o_searchview_more fa fa-search-plus fa-lg"
                        onclick="window.isKeepDropdownOpen=true"
                        title="Search More" role="img" aria-label="Search More"
                    />
                </td>
                <style>
                    .ui-autocomplete {
                        max-height: 400px;
                        overflow-y: auto;
                        /* prevent horizontal scrollbar */
                        overflow-x: hidden;
                    }
                    /* IE 6 doesn't support max-height
                    * we use height instead, but this forces the menu to always be this tall
                    */
                    * html .ui-autocomplete {
                        height: 400px;
                    }
                </style>
                <script>
                    $(function() {
                        $.ajax({
                            url: "/get_customer_list",
                            type: "GET",
                            dataType: 'json',
                            success: function(result){
                                $("#billing_code_ledger_advanced_search").autocomplete({
                                    minLength: 0,
                                    source: result.customer_list,
                                    select: function(event, ui) {
                                        window.isKeepDropdownOpen = true;
                                        $("#billing_code_ledger_advanced_search" ).val(ui.item.value);
                                        onBlurBillingCode();
                                        return false;
                                    }
                                })
                                .autocomplete("instance")._renderItem = function(ul, item) {
                                    return $("&lt;li>")
                                        .append("&lt;div>" + item.value + "&lt;br>" + item.name + "&lt;/div>")
                                        .appendTo(ul);
                                };
                            },
                            error: function(result){
                                console.log(result);
                            }
                        });
                    });
                    function onBlurBillingCode(){
                        billing_code = document.getElementById("billing_code_ledger_advanced_search").value;
                        $.ajax({
                            url: "/get_billing_name",
                            type: "GET",
                            data: {"content": billing_code},
                            dataType: 'json',
                            traditional: true,
                            success: function(result){
                                document.getElementById("billing_name_ledger_advanced_search").value = result.content.billing_name;
                                // need to put isKeepDropdownOpen = false here for dropdown back to normal clearing behavior
                                window.isKeepDropdownOpen = false;
                            },
                            error: function(result){
                                console.log(result);
                            }
                        });
                    }
                </script>
            </tr>
             <tr>
                <th>請求先名（得意先名）</th>
                <td colspan="3">
                    <input class="filter-item" id="billing_name_ledger_advanced_search" data-operator="=" data-name="customer_name" ref="" readonly="true" />
                </td>
            </tr>
           </table>
    </t>
</template>
